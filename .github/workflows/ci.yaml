# Nome do workflow — aparece na aba "Actions" do GitHub
name: CI

# Define quando o workflow será disparado
on:
  # Roda automaticamente ao fazer push nas branches principais
  push:
    # Roda automaticamente ao fazer push nas branches principais
    branches: [main, master]
  pull_request:
    # Roda também ao abrir ou atualizar um Pull Request nessas branches
    branches: [main, master]

# Um workflow é composto por um ou mais "jobs" que rodam em paralelo por padrão
jobs:
  # Nome amigável exibido na interface do GitHub Actions
  test:

    # Define o sistema operacional da máquina virtual que vai executar o job
    runs-on: ubuntu-latest

    # Lista de passos sequenciais que serão executados dentro do job
    steps:
      # Faz o checkout do código do repositório para dentro da máquina virtual
      - name: Checkout code
        uses: actions/checkout@v4

      # Instala o uv (gerenciador de dependências e ambientes virtuais em Rust, muito mais rápido que pip)
      - name: Install uv
        uses: astral-sh/setup-uv@v5

      # Instala o Python via uv, usando a versão definida no arquivo .python-version do projeto
      # Isso dispensa o uso da action actions/setup-python, centralizando tudo no uv
      - name: Set up Python
        run: uv python install

      # Instala todas as dependências do projeto (incluindo as de desenvolvimento, como o pytest)
      # --all-extras garante que dependências opcionais também sejam instaladas
      # --dev inclui as dependências do grupo de desenvolvimento definidas no pyproject.toml
      - name: Install dependencies and project
        run: uv sync --all-extras --dev

      # Executa os testes com pytest
      # "uv run" garante que o comando rode dentro do ambiente virtual gerenciado pelo uv
      # "-v" ativa o modo verbose, exibindo o nome de cada teste e seu resultado
      - name: Run tests
        run: uv run pytest -v
